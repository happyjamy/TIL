# ğŸš£â€â™‚ï¸ ìŠ¤ë ˆë“œ ì¡°ì •

# ìŠ¤ë ˆë“œ ì¢…ë£Œ

## ìŠ¤ë ˆë“œë¥¼ ì¢…ë£Œí•´ì•¼ í•˜ëŠ” ì´ìœ 

ìŠ¤ë ˆë“œëŠ” ì•„ë¬´ê²ƒë„ í•˜ì§€ ì•Šì•„ë„ ë¦¬ì†ŒìŠ¤ë¥¼ ì‚¬ìš©í•œë‹¤. ( Thread.sleep() )â†’ ë©”ëª¨ë¦¬ì™€ ì¼ë¶€ ì»¤ë„ ë¦¬ì†ŒìŠ¤

ì‹¤í–‰ ì¤‘ì´ë¼ë©´ cpu ì‹œê°„ê³¼ ìºì‹œê³µê°„ë„ ì‚¬ìš©.

ë”°ë¼ì„œ ìƒì„±í•œ ìŠ¤ë ˆë“œê°€ ì´ë¯¸ ì‘ì—…ì„ ì™„ë£Œ í–ˆë‹¤ë©´ ì´ ìŠ¤ë ˆë“œê°€ ì‚¬ìš©í•˜ëŠ” ë¦¬ì†ŒìŠ¤ë¥¼ ì •ë¦¬í•´ì•¼í•œë‹¤.

ë˜ ìŠ¤ë ˆë“œê°€ ì˜¤ì‘ë™ í•˜ê±°ë‚˜, ì• í”Œë¦¬ì¼€ì´ì…˜ ì „ì²´ë¥¼ ì¤‘ë‹¨í•˜ê¸° ìœ„í•´ì„œë„ ìŠ¤ë ˆë“œë¥¼ ì¢…ë£Œí•œë‹¤.

ë©”ì¸ ìŠ¤ë ˆë“œê°€ ì¢…ë£Œ ë¼ë„ í•˜ë‚˜ì˜ ìŠ¤ë ˆë“œë¼ë„ ë‚¨ì•„ ìˆë‹¤ë©´ ì• í”Œë¦¬ì¼€ì´ì…˜ì€ ì¢…ë£Œ ë˜ì§€ ì•ŠëŠ”ë‹¤.

<br>

## ì¢…ë£Œ ë©”ì„œë“œ

### Thread.interrupt

ê° ìŠ¤ë ˆë“œ ê°ì²´ëŠ” `interrupt` ë¼ëŠ” ë©”ì„œë“œë¥¼ ê°€ì§.

ì´ê²ƒìœ¼ë¡œ ì¸í„°ëŸ½íŠ¸ ì‹ í˜¸ë¥¼ ë³´ë‚¼ ìˆ˜ ìˆìŒ.

1. ì¸í„°ëŸ½íŠ¸ ë‹¹í–ˆì„ë•Œ `InterruptedException` ì„ ë°œìƒ ì‹œí‚¤ëŠ” ê²½ìš°

```java
private static class BlockingTask implements Runnable {

        @Override
        public void run() {
            //do things
            try {
				// ì–˜ê°€ InterruptedException ë°œìƒ
                Thread.sleep(500000);
            } catch (InterruptedException e) {
                System.out.println("Existing blocking thread");
            }
        }
    }
```

ì¸í„°ëŸ½íŠ¸ê°€ ë°œìƒí•˜ë©´ ë°”ë¡œ ì¡ì•„ì„œ ìŠ¤ë ˆë“œë¥¼ ì¢…ë£Œ.

<br>

2. ì¸í„°ëŸ½íŠ¸ ì‹ í˜¸ë¥¼ ëª…ì‹œì ìœ¼ë¡œ ì²˜ë¦¬í•˜ëŠ” ê²½ìš°

```java
private static class LongComputationTask implements Runnable {
        private BigInteger base;
        private BigInteger power;

        public LongComputationTask(BigInteger base, BigInteger power) {
            this.base = base;
            this.power = power;
        }

        @Override
        public void run() {
            System.out.println(base + "^" + power + " = " + pow(base, power));
        }

        private BigInteger pow(BigInteger base, BigInteger power) {
            BigInteger result = BigInteger.ONE;

            for (BigInteger i = BigInteger.ZERO; i.compareTo(power) != 0; i = i.add(BigInteger.ONE)) {
				// ì´ ë¶€ë¶„
                if (Thread.currentThread().isInterrupted()) {
                    System.out.println("Prematurely interrupted computation");
                    return BigInteger.ZERO;
                }
                result = result.multiply(base);
            }

            return result;
        }
    }
```

isInterrupted ë©”ì„œë“œì—ì„œ 'true'ê°€ ë°˜í™˜ë˜ë©´ ì´ì œ ê³„ì‚°ì„ ë©ˆì¶”ê³  ìŠ¤ë ˆë“œë¥¼ ì¢…ë£Œ.

<br>

### Daemon

`thread.setDaemon(true);`

í•´ë‹¹ ì†ì„±ì„ ì£¼ë©´ ë©”ì¸ ìŠ¤ë ˆë“œê°€ ì¢…ë£Œ ë¨ê³¼ ë™ì‹œì— ì „ì²´ ì•± ì¢…ë£Œ.

1. ë°±ê·¸ë¼ìš´ë“œ ì‘ì—…ì„ í•˜ê³  ì‹¶ì„ë•Œ.

ìŠ¤ë ˆë“œë¥¼ Daemon ìœ¼ë¡œ ìƒì„±í•˜ë©° ë³´í†µ ì£¼ì‘ì—…ì´ ì•„ë‹Œ ë°±ê·¸ë¼ìš´ë“œ ì‘ì—…ì„ ë§¡ìŒ.

ìš°ë¦¬ê°€ ì•±ì„ ì¢…ë£Œí•˜ê³  ì‹¶ì„ë•Œ ë°ëª¬ ìŠ¤ë ˆë“œ ì‹¤í–‰ ì—¬ë¶€ëŠ” ì‹ ê²½ ì“°ì§€ ì•Šê³  ì¢…ë£Œ í•  ìˆ˜ ìˆì–´ì•¼í•¨.

2. ì‘ì—… ìŠ¤ë ˆë“œì—ì„œ ì‹¤í–‰ ë˜ëŠ” ì½”ë“œë¥¼ ì œì–´ í•  ìˆ˜ ì—†ì„ë•Œ

ì™¸ë¶€ ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì‚¬ìš©í•˜ë©´ ìŠ¤ë ˆë“œ ì¸í„°ëŸ½íŠ¸ ì‹ í˜¸ ì²˜ë¦¬ ë¶ˆê°€.

ì´ë•Œ ìŠ¤ë ˆë“œì˜ Daemon ì†ì„±ì„ true ë¡œ ì£¼ë©´ ë©”ì¸ ìŠ¤ë ˆë“œê°€ ì¢…ë£Œ ë¨ê³¼ ë™ì‹œì— ì „ì²´ ì•± ì¢…ë£Œ

<br>

---

<br>

## ê°•ì˜ ì œê³µ Quiz

Question 1:

**ë‹¤ìŒ ì½”ë“œë¥¼ ì‚´í´ë³´ì„¸ìš”.**

```java
public static void main(String [] args) {
        Thread thread = new Thread(new WaitingForUserInput());
        thread.setName("InputWaitingThread");
        thread.start();
    }

    private static class WaitingForUserInput implements Runnable {
        @Override
        public void run() {
            try {
                while (true) {
                    char input = (char) System.in.read();
                    if(input == 'q') {
                        return;
                    }
                }
            } catch (IOException e) {
                System.out.println("An exception was caught " + e);
            };
        }
    }
```

**ì• í”Œë¦¬ì¼€ì´ì…˜ì„ í”„ë¡œê·¸ë¨ì ìœ¼ë¡œ ì¤‘ë‹¨í•  ìˆ˜ ìˆëŠ” ìœ ì¼í•œ ë°©ë²•ì€?**

ìŠ¤ë ˆë“œë¥¼ ë°ëª¬ìœ¼ë¡œ ë§Œë“œëŠ” ê²ƒ. System.in.read()ëŠ” Thread.interrupt();ì— ì‘ë‹µí•˜ì§€ ì•ŠìŒ.

Question 2:

```java
public static void main(String [] args) {
        Thread thread = new Thread(new SleepingThread());
        thread.start();
        thread.interrupt();
    }

    private static class SleepingThread implements Runnable {
        @Override
        public void run() {
            while (true) {
                try {
                    Thread.sleep(1000000);
                } catch (InterruptedException e) {
                }
            }
        }
    }
```

**ë‹¤ìŒ ì¤‘ ì˜¬ë°”ë¥¸ ë¬¸ì¥ì„ ì„ íƒí•˜ì„¸ìš”.**

return ì„ ì–¸ë¬¸ì„ catch ë¸”ë¡ ì•ˆì— ì¶”ê°€í•´ì„œ ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ì¤‘ì§€í•´ì•¼ í•œë‹¤.

catch ë¸”ë¡ì„ ë¹ˆ ìƒíƒœë¡œ ë‘ì–´ì„œëŠ” ì•ˆë˜ë©°, InterruptedException catch ë¸”ë¡ì„ ì‚¬ìš©í•´ì„œ (ì¶œë ¥ì„ ì¶”ê°€í•˜ê±°ë‚˜ run ë©”ì„œë“œì—ì„œ ë°˜í™˜ë˜ê¸° ì „ì— ì½”ë“œë¥¼ ì •ë¦¬í•˜ëŠ” ë°©ì‹ìœ¼ë¡œ) í˜„ì¬ ìŠ¤ë ˆë“œë¥¼ íš¨ìœ¨ì ìœ¼ë¡œ ì¤‘ë‹¨í•˜ëŠ” ê²ƒì´ ì¢‹ìŠµë‹ˆë‹¤.

<br>

<br>

---

<br>

<br>

# ìŠ¤ë ˆë“œ ì—°ê²°

ì—¬ëŸ¬ ìŠ¤ë ˆë“œê°€ ì‹¤í–‰ ë ë•Œë§ˆë‹¤ ë‹¤ë¥¸ ì‹œë‚˜ë¦¬ì˜¤ê°€ ë‚˜ì˜¨ë‹¤. (ëˆ„ê°€ ë¨¼ì € ëë‚˜ëŠ”ì§€ ë“±ë“±.) ìš°ë¦¬ëŠ” ìŠ¤ë ˆë“œ ì‹¤í–‰ ìˆœì„œë¥¼ ì ˆëŒ€ ì•Œ ìˆ˜ ì—†ìŒ.

ë§Œì•½ í•œ ìŠ¤ë ˆë“œê°€ ë‹¤ë¥¸ ìŠ¤ë ˆë“œì— ì˜ì¡´í•˜ë©´? ìŠ¤ë ˆë“œB ëŠ” ìŠ¤ë ˆë“œAì˜ ê²°ê³¼ê°’ì´ í•„ìš”í•˜ë‹¤.

- ë£¨í”„ë¡œ í™•ì¸ í•˜ë©´?

ê·¸ëŸ¬ë©´ ë£¨í”„ë¡œ í™•ì¸í•˜ëŠ”ë° cpu ë¦¬ì†ŒìŠ¤ê°€ ë“¤ì–´ê°€ ì˜¤íˆë ¤ ìŠ¤ë ˆë“œAì˜ ì—°ì‚°ì´ ëŠë ¤ì§.

ì°¨ë¦¬ë¦¬ ìŠ¤ë ˆë“œBë¥¼ sleep í•˜ê³  ë¹„ì¼œì£¼ëŠ” í¸ì´ ë‚˜ìŒ!

<br>

### Thread.join()

race condition (ê²½ìŸ ì¡°ê±´) - ë‘ ê°œ ì´ìƒì˜ ìŠ¤ë ˆë“œê°€ ìˆœì„œë‚˜ íƒ€ì´ë°ì— ë”°ë¼ ê³µìœ  ìì›ì— ì ‘ê·¼í•˜ëŠ” ìƒí™©, ëˆ„ê°€ ì–´ë–»ê²Œ ë¨¼ì € ì ‘ê·¼ í•  ìˆ˜ ìˆì„ì§€ ì•Œ ìˆ˜ ì—†ë‹¤.

ì˜ˆì‹œ

- ìŠ¤ë ˆë“œA ëŠ” ìŠ¤ë ˆë“œBì˜ ê³„ì‚° ê²°ê³¼ ë³€ìˆ˜ result ë¥¼ get í•´ì™€ì„œ ê³„ì‚°ì„ í•œë‹¤.
- ì´ë•Œ ê³µìœ ë˜ëŠ” ìì›ì€ ê³„ì‚° ê²°ê³¼ ë³€ìˆ˜ result.
- ìŠ¤ë ˆë“œAëŠ” ì–¸ì œ ìŠ¤ë ˆë“œBê°€ ê³„ì‚°ì„ ë‹¤ ëë‚´ëŠ”ì§€ ì•Œ ìˆ˜ ì—†ë‹¤.

`Thread.join()` ì€ ì´ëŸ´ë•Œ ì‚¬ìš©!

`Thread.join()`ì„ í•˜ë©´ í•´ë‹¹ ìŠ¤ë ˆë“œì˜ `run()` ì½”ë“œê°€ ë‹¤ ì‹¤í–‰ ë ë•Œê¹Œì§€ ê¸°ë‹¤ë¦°ë‹¤.

ì˜ˆì‹œì¼€ì´ìŠ¤ì—ì„œëŠ” ê³„ì‚° ê²°ê³¼ ë³€ìˆ˜ result ë™ê¸°í™” ê°€ëŠ¥.

í•˜ì§€ë§Œ ì´ë•Œ ì—°ì‚°ì´ ì˜¤ë˜ ê±¸ë¦¬ëŠ” ì¼€ì´ìŠ¤ê°€ ìˆìœ¼ë©´ ë¬´í•œì • ê¸°ë‹¤ë¦¼.

`Thread.join(2000)` ì´ë•Œ ì´ë ‡ê²Œ ìŠ¤ë ˆë“œ ê¸°ë‹¤ë¦¬ëŠ” ì‹œê°„ì„ ì •í•  ìˆ˜ ìˆìŒ.

í•´ë‹¹ 2000ms ë§Œ ê¸°ë‹¤ë¦¬ê³  ë„˜ì–´ê°.

> í•œ ìŠ¤ë ˆë“œê°€ ì™„ë£Œë˜ëŠ”ë° ì§€ë‚˜ì¹˜ê²Œ ì˜¤ëœ ì‹œê°„ì´ ê±¸ë¦¬ëŠ” ìƒí™©ì„ ê²½ê³„í•˜ì!

<br>

## ì˜¤ëŠ˜ì˜ exercise

[ComplexCalculation](https://github.com/happyjamy/TIL/blob/main/Java_/multiThread/exercise/ComplexCalculation.java)
